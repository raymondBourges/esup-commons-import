<?xml version="1.0" encoding="UTF-8" ?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xmlns:util="http://www.springframework.org/schema/util"
	xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:tx="http://www.springframework.org/schema/tx"
	xmlns:jaxws="http://cxf.apache.org/jaxws"
	xmlns:jaxrs="http://cxf.apache.org/jaxrs"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd 
		http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.0.xsd
		http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.0.xsd
		http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.0.xsd
		http://cxf.apache.org/jaxws http://cxf.apache.org/schemas/jaxws.xsd
		http://cxf.apache.org/jaxrs 
  		http://cxf.apache.org/schemas/jaxrs.xsd">
	

    <aop:config>
        <aop:pointcut id="domainMethods"
            expression="execution(* org.esupportail.*.domain.DomainServiceImpl.*(..))" />
        <aop:advisor advice-ref="txAdvice" pointcut-ref="domainMethods" />
    </aop:config>
    
    <tx:advice id="txAdvice" transaction-manager="txManager">
        <tx:attributes>
            <tx:method name="add*" propagation="REQUIRED" />
            <tx:method name="delete*" propagation="REQUIRED" />
            <tx:method name="update*" propagation="REQUIRED" />
            <tx:method name="*" propagation="SUPPORTS" read-only="true"/>
        </tx:attributes>
    </tx:advice>
	
	<import resource="classpath*:META-INF/esup-formation-dao-dao.xml" />
	<!-- <import resource="classpath*:/properties/dao/dao.xml" /> -->
	
	<bean id="domainService" class="org.esupportail.formation.domain.DomainServiceImpl">
		<property name="daoService" ref="daoService" />
	</bean>
	
	<import resource="classpath:META-INF/cxf/cxf.xml" />
  	<import resource="classpath:META-INF/cxf/cxf-extension-soap.xml" />
  	<import resource="classpath:META-INF/cxf/cxf-servlet.xml" />
  
   <jaxws:endpoint id="domainService.remoteService" implementor="#domainService"
        address="/TodoService">
    </jaxws:endpoint>
    
    <jaxrs:server id="domainServiceRest" address="/rest">
	 	<jaxrs:serviceBeans>
	  		<ref bean="domainService" />
	 	</jaxrs:serviceBeans>
	 	<jaxrs:providers>
	  		<ref bean="jsonProvider" />
	 	</jaxrs:providers>
	</jaxrs:server>
 
<bean id="jsonProvider" class="org.codehaus.jackson.jaxrs.JacksonJaxbJsonProvider" />
  
</beans>